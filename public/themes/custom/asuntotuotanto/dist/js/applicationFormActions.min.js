((t,e)=>{jQuery(document).ajaxStop((()=>{const e=t("[id^=apartment_list_select_]");e.length>0&&e.is(":disabled")&&e.prop("disabled",!1)}));const a=drupalSettings.path.currentLanguage,n={Delete:{fi:"Poista",en:"Delete"},Open:{fi:"Katso huoneistoa",en:"Open apartment page"},Apartment:{fi:"huoneisto",en:"apartment"},Add:{fi:"Lis채채 uusi huoneisto",en:"Add an apartment to the list"},Updated:{fi:"Huoneistojen j채rjestys on p채ivitetty",en:"Apartment list order has been updated."}},i=document.getElementsByClassName("sr-information-box")[0],r=document.getElementById("application_form_apartments_list"),l=()=>r.getElementsByClassName("application-form__apartments-item").length,s=()=>{const t=document.querySelector('[data-drupal-selector="edit-apartment-0-id"]').parentElement.parentElement.parentElement.parentElement.parentElement,e=t.children.length;return t.children[e-1].getElementsByTagName("select")[0]},o=()=>[...document.querySelectorAll('[data-drupal-selector="edit-apartment"] > table select')].filter((t=>t.getAttribute("data-drupal-selector").includes("-id"))).map((t=>t.value)).filter((t=>"0"!==t));new MutationObserver((t=>{t.forEach((t=>{"childList"===t.type&&[...document.getElementsByClassName("application-form__apartments-item")].map((t=>{const e=t.querySelectorAll("button[data-list-position-action-button]"),a=[...t.parentElement.children].indexOf(t);t.classList.contains("application-form__apartments-item--with-select")||(0!==a||t.nextElementSibling.classList.contains("application-form__apartments-item--with-select")||(e[0].disabled=!0,e[1].disabled=!1),a>0&&a<l()-1&&(t.nextElementSibling.classList.contains("application-form__apartments-item--with-select")?(e[0].disabled=!1,e[1].disabled=!0):(e[0].disabled=!1,e[1].disabled=!1)),a===l()-1&&(e[0].disabled=!1,e[1].disabled=!0))}))}))})).observe(r,{childList:!0});const p=(t,a,n)=>{const i=document.createElement("p");i.classList.add(...t);const r=document.createElement("span"),l=document.createTextNode(e.t(a));r.classList.add("visually-hidden"),r.appendChild(l);const s=document.createElement("span"),o=document.createTextNode(n);return s.appendChild(o),i.append(r,s),i},d=(t,a,n=!1)=>{const i=document.createElement("button");i.classList.add(...t);const r=document.createElement("span"),l=document.createTextNode(e.t(a));return r.append(l),i.append(r),i.setAttribute("type","button"),n&&(i.disabled=!0),i},c=(t,a)=>{const n=document.createElement("li"),i=document.createElement("span"),r=document.createTextNode(e.t(t));i.appendChild(r);const l=document.createElement("span"),s=document.createTextNode(e.t(a));return l.appendChild(s),n.append(i,l),n},m=(t,e=[])=>{const a=document.createElement(t);return a.classList.add(...e),a},u=e=>{const r=e.parentElement.parentElement.parentElement,l=r.previousElementSibling;if(null!==l){l.before(r);const s=v(e),o=y(s);jQuery("#application_form_apartments_list").children("li").each(((e,a)=>{const n=jQuery(a).first().find(".application-form-apartment__apartment-number").first()[0];if(null!=n){const a=t(n).find("span").last()[0].textContent;g().filter((function(){return jQuery(this).find("option:selected").text().includes(a)})).first().closest("tr").find("[data-drupal-selector$=-weight]")[0].value=e}})),o.change(),setTimeout((()=>{e.disabled?e.nextElementSibling.focus():e.focus()}),10);const p=document.createElement("p");p.appendChild(document.createTextNode(n.Updated[a])),i.append(p)}},_=a=>{const n=a.parentElement.parentElement.parentElement,r=n.nextElementSibling;if(null!==r&&!r.classList.contains("application-form__apartments-item--with-select")){r.after(n);const l=v(a),s=y(l);jQuery("#application_form_apartments_list").children("li").each(((e,a)=>{const n=jQuery(a).first().find(".application-form-apartment__apartment-number").first()[0];if(null!=n){const a=t(n).find("span").last()[0].textContent;g().filter((function(){return jQuery(this).find("option:selected").text().includes(a)})).first().closest("tr").find("[data-drupal-selector$=-weight]")[0].value=e}})),s.change(),setTimeout((()=>{a.disabled?a.previousElementSibling.focus():a.focus()}),10);const o=document.createElement("p");o.appendChild(document.createTextNode(e.t("Apartment list order has been updated."))),i.append(o)}},f=({target:t})=>{"raise"===t.getAttribute("data-list-position-action-button")&&u(t),"lower"===t.getAttribute("data-list-position-action-button")&&_(t),"application-form-apartment__apartment-delete-button"===t.getAttribute("class")&&(t=>{jQuery(".application-form-apartment__apartment-delete-button").each(((t,e)=>{jQuery(e).prop("disabled",!0)}));const e=t.parentElement.parentElement.parentElement,a=v(t),n=y(a),i=n.closest("tr").find(":submit")[0];n.val(0),n.change(),e.innerHTML="<div class='application-form-apartment-loader-wrapper'><div class='application-form-apartment-loader'></div></div>",console.log(i),setTimeout((()=>{jQuery(i).trigger("mousedown"),e.remove(),jQuery(".application-form-apartment__apartment-delete-button").each(((t,e)=>{jQuery(e).prop("disabled",!1)}))}),750)})(t)},b=({target:r})=>{const p=t('[data-drupal-selector="edit-apartment-add-more"]');l()<=5&&l()>1&&"0"!==s().value&&p.mousedown();const d=r.parentElement;r.parentElement.parentElement.parentElement.parentElement.addEventListener("click",f),d.appendChild((()=>{const t=document.createElement("div");t.classList.add("application-form-apartment__apartment-add-actions-wrapper");const r=l()-1,p=`apartment_list_select_${r}`,d=document.createElement("div");d.classList.add("hds-select-element");const c=document.createElement("label"),m=document.createTextNode(n.Apartment[a]);c.appendChild(m),c.setAttribute("for",p);const u=document.createElement("div");u.classList.add("hds-select-element__select-wrapper");const _=o(),f=s().cloneNode(!0);return[...f.options].map(((t,e)=>{if(e>0){const e=t.innerHTML.split(" | ");t.innerHTML=`${e[0]} | ${e[1]} | ${e[3]}`}})),f.classList.add("hds-select-element__select"),f.setAttribute("id",p),f.setAttribute("data-id",r),f.setAttribute("data-drupal-selector","custom_apartment_select"),[...f.options].filter((t=>_.includes(t.value))).forEach((t=>{f.removeChild(t)})),f.addEventListener("change",(({target:t})=>{const a=document.querySelector(`[data-drupal-selector="edit-apartment-${r}-id"]`),n=document.getElementsByClassName("application-form-apartment__apartment-add-button")[0],s=t.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;s.setAttribute("data-id",r),a.value=t.value,a.dispatchEvent(new Event("change")),s.classList.remove("application-form__apartments-item--with-select");const o=a.options[a.selectedIndex].text.split(" | "),p={apartment_number:o[0],apartment_structure:o[1],apartment_floor:o[2],apartment_living_area_size:o[3],apartment_sales_price:o[4],apartment_debt_free_sales_price:o[5]};s.innerHTML=E(p,t.value).innerHTML;const d=document.createElement("p");d.appendChild(document.createTextNode(e.t("Apartment list has been updated."))),i.append(d);const c=[...s.parentElement.children].indexOf(s);0===c&&(s.querySelector("button").disabled=!0),c===l()-1&&(s.querySelector('button[data-list-position-action-button="lower"]').disabled=!0),c>0&&(s.previousElementSibling.querySelector('button[data-list-position-action-button="lower"]').disabled=!1),s.nextElementSibling.classList.contains("application-form__apartments-item--with-select")&&(s.querySelector('button[data-list-position-action-button="lower"]').disabled=!0),n&&(n.removeAttribute("disabled"),n.focus())})),u.appendChild(f),d.append(c,u),t.appendChild(d),t})()),r.remove(),(()=>{const t=document.querySelectorAll('[data-drupal-selector="custom_apartment_select"]');t[t.length-1].focus()})(),l()<5&&h()},E=(t,i,r=!1)=>{let{apartment_number:s,apartment_structure:o,apartment_floor:u,apartment_living_area_size:_,apartment_sales_price:f,apartment_debt_free_sales_price:E}=t;const h=document.querySelectorAll("[data-drupal-selector='asu-application-haso-form']").length>0?"HASO":"hitas",g=m("li",["application-form__apartments-item"]);r&&g.classList.add("application-form__apartments-item--with-select");const v=m("article",["application-form-apartment"]),y=p(["application-form-apartment__list-position","is-desktop"],"List position",""),A=m("div",["application-form-apartment__header"]),L=p(["application-form-apartment__list-position","is-mobile"],"List position",""),x=p(["application-form-apartment__apartment-number"],"Apartment",s),w=p(["application-form-apartment__apartment-structure"],"Apartment structure",o),S=d(["application-form-apartment__apartment-add-button"],n.Add[a]);S.addEventListener("click",b),l()>0&&S.setAttribute("disabled",!0),r?A.append(L,S):A.append(L,x,w);const C=document.createElement("div");C.classList.add("application-form-apartment__list-position-actions");const j=d("",`Raise on the list, apartment ${s}`,r&&!0);j.setAttribute("data-list-position-action-button","raise");const N=d("",`Lower on the list, apartment ${s}`,r&&!0);N.setAttribute("data-list-position-action-button","lower"),C.append(j,N);const T=m("ul",["application-form-apartment__information"]),$=c("Floor",u),Q=c("Living area size",_);let q="",B="";"HASO"===h?(q=e.t("Right of occupancy payment"),B="",E=""):(q=e.t("Sales price"),B=e.t("Debt free sales price"));const O=c(q,f),H=c(B,E);T.append($,Q,O,H);const D=m("div",["application-form-apartment__actions"]),M=d(["application-form-apartment__apartment-delete-button"],n.Delete[a]);M.setAttribute("aria-label",`${n.Delete[a]}, ${n.Apartment[a]} ${s}`);const k=document.createElement("a"),z=document.createTextNode(n.Open[a]);return k.appendChild(z),k.setAttribute("href",`${window.location.origin}/node/${i}`),k.setAttribute("aria-label",`${n.Open[a]}, ${n.Apartment[a]} ${s}`),D.append(M,k),r?v.append(y,A,C):v.append(y,A,C,T,D),g.appendChild(v),g},h=()=>{r.append(E({},null,!0))},g=()=>t('[data-drupal-selector="edit-apartment"] > table select'),v=t=>jQuery(t.parentElement.parentElement.parentElement).first().find(".application-form-apartment__apartment-number").first().find("span").last()[0].textContent,y=e=>t('[data-drupal-selector="edit-apartment"] > table select').filter((function(){return jQuery(this).find("option:selected").text().includes(e)})).first(),A=()=>{if(o().length>0&&([...document.querySelectorAll('[data-drupal-selector="edit-apartment"] > table select')].filter((t=>t.getAttribute("data-drupal-selector").includes("-id"))).filter((t=>"0"!==t.value)).map((t=>{const e=t.options[t.selectedIndex].text.split(" | "),a={apartment_number:e[0],apartment_structure:e[1],apartment_floor:e[2],apartment_living_area_size:e[3],apartment_sales_price:e[4],apartment_debt_free_sales_price:e[5]};r.append(E(a,t.value,!1))})),1===l()&&[...document.getElementsByClassName("application-form__apartments-item")[0].querySelectorAll("[data-list-position-action-button]")].map((t=>{t.disabled=!0})),l()<5)){h();const t=document.getElementsByClassName("application-form-apartment__apartment-add-button")[0];t&&t.removeAttribute("disabled")}0===l()&&h();const t=document.getElementsByClassName("application-form__apartments-item");t.length>0&&[...t].map(((t,e)=>{t.setAttribute("data-id",e),t.addEventListener("click",f)}))};window.onload=A})(jQuery,Drupal);