((t,e)=>{jQuery(document).ajaxStop((()=>{const e=t(".application-form-apartment__apartment-add-button"),a=t('[data-drupal-selector="custom_apartment_select"]');e&&0==a.length&&e.first().attr("disabled",!1);const n=t("[id^=apartment_list_select_]");n.length>0&&n.is(":disabled")&&n.prop("disabled",!1)}));const a=drupalSettings.path.currentLanguage,n={Delete:{fi:"Poista",en:"Delete"},Open:{fi:"Katso huoneistoa",en:"Open apartment page"},Apartment:{fi:"huoneisto",en:"apartment"},Add:{fi:"Lisää uusi huoneisto",en:"Add an apartment to the list"},Updated:{fi:"Huoneistojen järjestys on päivitetty",en:"Apartment list order has been updated."},ApartmentAdded:{fi:"Lisätty huoneisto listaukseen.",en:"Added to the apartment list."},ApartmentRemoved:{fi:"Poistettu huoneisto listauksesta.",en:"Removed from the apartment list."}},i=document.getElementsByClassName("sr-information-box")[0],r=document.getElementById("application_form_apartments_list"),l=()=>r.getElementsByClassName("application-form__apartments-item").length,s=()=>{const t=document.querySelector('[data-drupal-selector="edit-apartment-0-id"]').parentElement.parentElement.parentElement.parentElement.parentElement,e=t.children.length;return t.children[e-1].getElementsByTagName("select")[0]},o=()=>[...document.querySelectorAll('[data-drupal-selector="edit-apartment"] > table select')].filter((t=>t.getAttribute("data-drupal-selector").includes("-id"))).map((t=>t.value)).filter((t=>"0"!==t));new MutationObserver((t=>{t.forEach((t=>{"childList"===t.type&&[...document.getElementsByClassName("application-form__apartments-item")].map((t=>{const e=t.querySelectorAll("button[data-list-position-action-button]"),a=[...t.parentElement.children].indexOf(t);t.classList.contains("application-form__apartments-item--with-select")||(0!==a||t.nextElementSibling.classList.contains("application-form__apartments-item--with-select")||(e[0].disabled=!0,e[1].disabled=!1),a>0&&a<l()-1&&(t.nextElementSibling.classList.contains("application-form__apartments-item--with-select")?(e[0].disabled=!1,e[1].disabled=!0):(e[0].disabled=!1,e[1].disabled=!1)),a===l()-1&&(e[0].disabled=!1,e[1].disabled=!0))}))}))})).observe(r,{childList:!0});const p=(t,a,n)=>{const i=document.createElement("p");i.classList.add(...t);const r=document.createElement("span"),l=document.createTextNode(e.t(a));r.classList.add("visually-hidden"),r.appendChild(l);const s=document.createElement("span"),o=document.createTextNode(n);return s.appendChild(o),i.append(r,s),i},d=(t,a,n=!1)=>{const i=document.createElement("button");i.classList.add(...t);const r=document.createElement("span"),l=document.createTextNode(e.t(a));return r.append(l),i.append(r),i.setAttribute("type","button"),n&&(i.disabled=!0),i},c=(t,a)=>{const n=document.createElement("li"),i=document.createElement("span"),r=document.createTextNode(e.t(t));i.appendChild(r);const l=document.createElement("span"),s=document.createTextNode(e.t(a));return l.appendChild(s),n.append(i,l),n},m=(t,e=[])=>{const a=document.createElement(t);return a.classList.add(...e),a},u=e=>{const r=e.parentElement.parentElement.parentElement,l=r.previousElementSibling;if(null!==l){l.before(r);const s=v(e),o=A(s);jQuery("#application_form_apartments_list").children("li").each(((e,a)=>{const n=jQuery(a).first().find(".application-form-apartment__apartment-number").first()[0];if(null!=n){const a=t(n).find("span").last()[0].textContent;g().filter((function(){return jQuery(this).find("option:selected").text().includes(a)})).first().closest("tr").find("[data-drupal-selector$=-weight]")[0].value=e}})),o.change(),setTimeout((()=>{e.disabled?e.nextElementSibling.focus():e.focus()}),50);const p=document.createElement("p");p.appendChild(document.createTextNode(n.Updated[a])),i.append(p)}},_=a=>{const n=a.parentElement.parentElement.parentElement,r=n.nextElementSibling;if(null!==r&&!r.classList.contains("application-form__apartments-item--with-select")){r.after(n);const l=v(a),s=A(l);jQuery("#application_form_apartments_list").children("li").each(((e,a)=>{const n=jQuery(a).first().find(".application-form-apartment__apartment-number").first()[0];if(null!=n){const a=t(n).find("span").last()[0].textContent;g().filter((function(){return jQuery(this).find("option:selected").text().includes(a)})).first().closest("tr").find("[data-drupal-selector$=-weight]")[0].value=e}})),s.change(),setTimeout((()=>{a.disabled?a.previousElementSibling.focus():a.focus()}),10);const o=document.createElement("p");o.appendChild(document.createTextNode(e.t("Apartment list order has been updated."))),i.append(o)}},f=({target:t})=>{"raise"===t.getAttribute("data-list-position-action-button")&&u(t),"lower"===t.getAttribute("data-list-position-action-button")&&_(t),"application-form-apartment__apartment-delete-button"===t.getAttribute("class")&&(t=>{jQuery(".application-form-apartment__apartment-delete-button").each(((t,e)=>{jQuery(e).prop("disabled",!0)}));const e=t.parentElement.parentElement.parentElement,r=v(t);if(!r)return;const l=A(r),s=l.closest("tr").find(":submit")[0],o=document.createElement("p");o.appendChild(document.createTextNode(n.ApartmentRemoved[a])),i.append(o),l.val(0),l.change(),e.innerHTML="<div class='application-form-apartment-loader-wrapper'><div class='application-form-apartment-loader'></div></div>",setTimeout((()=>{jQuery(s).trigger("mousedown"),e.remove(),jQuery(".application-form-apartment__apartment-delete-button").each(((t,e)=>{jQuery(e).prop("disabled",!1)}))}),750)})(t)},b=({target:e})=>{const r=t('[data-drupal-selector="edit-apartment-add-more"]');l()<=5&&l()>1&&"0"!==s().value&&r.mousedown();const p=e.parentElement;e.parentElement.parentElement.parentElement.parentElement.addEventListener("click",f),p.appendChild((()=>{const e=document.createElement("div");e.classList.add("application-form-apartment__apartment-add-actions-wrapper");const r=l()-1,p=`apartment_list_select_${r}`,d=document.createElement("div");d.classList.add("hds-select-element");const c=document.createElement("label"),m=document.createTextNode(n.Apartment[a]);c.appendChild(m),c.setAttribute("for",p);const u=document.createElement("div");u.classList.add("hds-select-element__select-wrapper");const _=o(),f=s().cloneNode(!0);return[...f.options].map(((t,e)=>{if(e>0){const e=t.innerHTML.split(" | ");t.innerHTML=`${e[0]} | ${e[1]} | ${e[3]}`}})),f.classList.add("hds-select-element__select"),f.setAttribute("id",p),f.setAttribute("data-id",r),f.setAttribute("data-drupal-selector","custom_apartment_select"),"apartment_list_select_0"!=f.id&&0!=t.active&&f.setAttribute("disabled",!0),[...f.options].filter((t=>_.includes(t.value))).forEach((t=>{f.removeChild(t)})),f.addEventListener("change",(({target:e})=>{const s=document.querySelector(`[data-drupal-selector="edit-apartment-${r}-id"]`),o=document.getElementsByClassName("application-form-apartment__apartment-add-button")[0],p=e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;p.setAttribute("data-id",r),s.value=e.value,s.dispatchEvent(new Event("change")),p.classList.remove("application-form__apartments-item--with-select");const d=s.options[s.selectedIndex].text.split(" | "),c={apartment_number:d[0],apartment_structure:d[1],apartment_floor:d[2],apartment_living_area_size:d[3],apartment_debt_free_sales_price:d[4],apartment_sales_price:d[5]};p.innerHTML=h(c,e.value).innerHTML;const m=document.createElement("p");m.appendChild(document.createTextNode(n.ApartmentAdded[a])),i.append(m);const u=[...p.parentElement.children].indexOf(p);0===u&&(p.querySelector("button").disabled=!0),u===l()-1&&(p.querySelector('button[data-list-position-action-button="lower"]').disabled=!0),u>0&&(p.previousElementSibling.querySelector('button[data-list-position-action-button="lower"]').disabled=!1),p.nextElementSibling.classList.contains("application-form__apartments-item--with-select")&&(p.querySelector('button[data-list-position-action-button="lower"]').disabled=!0),o&&(0==t.active&&o.removeAttribute("disabled"),o.focus())})),u.appendChild(f),d.append(c,u),e.appendChild(d),e})()),e.remove(),(()=>{const t=document.querySelectorAll('[data-drupal-selector="custom_apartment_select"]');t[t.length-1].focus()})(),l()<5&&E()},h=(t,i,r=!1)=>{let{apartment_number:s,apartment_structure:o,apartment_floor:u,apartment_living_area_size:_,apartment_sales_price:f,apartment_debt_free_sales_price:h}=t;const E=document.querySelectorAll("[data-drupal-selector='asu-application-haso-form']").length>0?"HASO":"hitas",g=m("li",["application-form__apartments-item"]);r&&g.classList.add("application-form__apartments-item--with-select");const v=m("article",["application-form-apartment"]),A=p(["application-form-apartment__list-position","is-desktop"],"List position",""),y=m("div",["application-form-apartment__header"]),L=p(["application-form-apartment__list-position","is-mobile"],"List position",""),x=p(["application-form-apartment__apartment-number"],"Apartment",s),w=p(["application-form-apartment__apartment-structure"],"Apartment structure",o),C=d(["application-form-apartment__apartment-add-button"],n.Add[a]);C.addEventListener("click",b),l()>0&&C.setAttribute("disabled",!0),r?y.append(L,C):y.append(L,x,w);const S=document.createElement("div");S.classList.add("application-form-apartment__list-position-actions");const N=d("",`Raise on the list, apartment ${s}`,r&&!0);N.setAttribute("data-list-position-action-button","raise");const T=d("",`Lower on the list, apartment ${s}`,r&&!0);T.setAttribute("data-list-position-action-button","lower"),S.append(N,T);const j=m("ul",["application-form-apartment__information"]),$=c("Floor",u),Q=c("Living area size",_);let q="",B="";"HASO"===E?(q=e.t("Right of occupancy payment"),B="",h=""):(q=e.t("Sales price"),B=e.t("Debt free sales price"));const O=c(q,f),H=c(B,h);j.append($,Q,O,H);const k=m("div",["application-form-apartment__actions"]),D=d(["application-form-apartment__apartment-delete-button"],n.Delete[a]);D.setAttribute("aria-label",`${n.Delete[a]}, ${n.Apartment[a]} ${s}`);const M=document.createElement("a"),R=document.createTextNode(n.Open[a]);return M.appendChild(R),M.setAttribute("href",`${window.location.origin}/node/${i}`),M.setAttribute("aria-label",`${n.Open[a]}, ${n.Apartment[a]} ${s}`),k.append(D,M),r?v.append(A,y,S):v.append(A,y,S,j,k),g.appendChild(v),g},E=()=>{r.append(h({},null,!0))},g=()=>t('[data-drupal-selector="edit-apartment"] > table select'),v=t=>jQuery(t.parentElement.parentElement.parentElement).first().find(".application-form-apartment__apartment-number").first().find("span").last()[0].textContent,A=e=>t('[data-drupal-selector="edit-apartment"] > table select').filter((function(){return jQuery(this).find("option:selected").text().includes(e)})).first(),y=()=>{if(o().length>0&&([...document.querySelectorAll('[data-drupal-selector="edit-apartment"] > table select')].filter((t=>t.getAttribute("data-drupal-selector").includes("-id"))).filter((t=>"0"!==t.value)).map((t=>{const e=t.options[t.selectedIndex].text.split(" | "),a={apartment_number:e[0],apartment_structure:e[1],apartment_floor:e[2],apartment_living_area_size:e[3],apartment_debt_free_sales_price:e[4],apartment_sales_price:e[5]};r.append(h(a,t.value,!1))})),1===l()&&[...document.getElementsByClassName("application-form__apartments-item")[0].querySelectorAll("[data-list-position-action-button]")].map((t=>{t.disabled=!0})),l()<5)){E();const t=document.getElementsByClassName("application-form-apartment__apartment-add-button")[0];t&&t.removeAttribute("disabled")}0===l()&&E();const t=document.getElementsByClassName("application-form__apartments-item");t.length>0&&[...t].map(((t,e)=>{t.setAttribute("data-id",e),t.addEventListener("click",f)}))};window.onload=y})(jQuery,Drupal);