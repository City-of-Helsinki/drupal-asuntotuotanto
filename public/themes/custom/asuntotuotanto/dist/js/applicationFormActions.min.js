((e,t)=>{jQuery(document).ajaxStop(()=>{let t=e(".application-form-apartment__apartment-add-button"),a=e('[data-drupal-selector="custom_apartment_select"]');t&&0==a.length&&t.first().attr("disabled",!1);let n=e("[id^=apartment_list_select_]");n.length>0&&n.is(":disabled")&&n.prop("disabled",!1)});let a=drupalSettings.path.currentLanguage,n={Delete:{fi:"Poista",en:"Delete"},Open:{fi:"Katso huoneistoa",en:"Open apartment page"},Apartment:{fi:"huoneisto",en:"apartment"},Add:{fi:"Lis\xe4\xe4 uusi huoneisto",en:"Add an apartment to the list"},Updated:{fi:"Huoneistojen j\xe4rjestys on p\xe4ivitetty",en:"Apartment list order has been updated."},ApartmentAdded:{fi:"Lis\xe4tty huoneisto listaukseen.",en:"Added to the apartment list."},ApartmentRemoved:{fi:"Poistettu huoneisto listauksesta.",en:"Removed from the apartment list."}},l=document.getElementsByClassName("sr-information-box")[0],i=document.getElementById("application_form_apartments_list"),r=()=>i.getElementsByClassName("application-form__apartments-item").length,p=()=>{let e=document.querySelector('[data-drupal-selector="edit-apartment-0-id"]'),t=e.parentElement.parentElement.parentElement.parentElement.parentElement,a=t.children.length,n=t.children[a-1];return n.getElementsByTagName("select")[0]},s=()=>{let e=document.querySelectorAll('[data-drupal-selector="edit-apartment"] > table select');return[...e].filter(e=>e.getAttribute("data-drupal-selector").includes("-id")).map(e=>e.value).filter(e=>"0"!==e)};function o(e,t,a,n){e[0]&&e[1]&&(t&&!n?(e[0].disabled=!0,e[1].disabled=!1):a?(e[0].disabled=!1,e[1].disabled=!0):n?(e[0].disabled=!1,e[1].disabled=!0):(e[0].disabled=!1,e[1].disabled=!1))}let d=e=>{e.forEach(e=>{if("childList"!==e.type)return;let t=document.getElementsByClassName("application-form__apartments-item"),a=r();[...t].forEach((e,t)=>{if(e.classList.contains("application-form__apartments-item--with-select"))return;let n=e.querySelectorAll("button[data-list-position-action-button]"),l=0===t,i=t===a-1,r=e.nextElementSibling&&e.nextElementSibling.classList&&e.nextElementSibling.classList.contains("application-form__apartments-item--with-select");o(n,l,i,r)})})},m=new MutationObserver(d);m.observe(i,{childList:!0});let c=(e,a,n)=>{let l=document.createElement("p");l.classList.add(...e);let i=document.createElement("span"),r=document.createTextNode(t.t(a));i.classList.add("visually-hidden"),i.appendChild(r);let p=document.createElement("span"),s=document.createTextNode(n);return p.appendChild(s),l.append(i,p),l},u=(e,a,n=!1)=>{let l=document.createElement("button");l.classList.add(...e);let i=document.createElement("span"),r=document.createTextNode(t.t(a));return i.append(r),l.append(i),l.setAttribute("type","button"),n&&(l.disabled=!0),l},f=(e,a)=>{let n=document.createElement("li"),l=document.createElement("span"),i=document.createTextNode(t.t(e));l.appendChild(i);let r=document.createElement("span"),p=document.createTextNode(t.t(a));return r.appendChild(p),n.append(l,r),n},b=()=>{let e=document.querySelectorAll('[data-drupal-selector="custom_apartment_select"]'),t=e.length,a=e[t-1];a.focus()},E=()=>{let t=document.createElement("div");t.classList.add("application-form-apartment__apartment-add-actions-wrapper");let i=r()-1,o=`apartment_list_select_${i}`,d=document.createElement("div");d.classList.add("hds-select-element");let m=document.createElement("label"),c=document.createTextNode(n.Apartment[a]);m.appendChild(c),m.setAttribute("for",o);let u=document.createElement("div");u.classList.add("hds-select-element__select-wrapper");let f=s(),b=p().cloneNode(!0);[...b.options].map((e,t)=>{if(t>0){let a=e.innerHTML.split(" | ");e.innerHTML=`${a[0]} | ${a[1]} | ${a[3]}`}}),b.classList.add("hds-select-element__select"),b.setAttribute("id",o),b.setAttribute("data-id",i),b.setAttribute("data-drupal-selector","custom_apartment_select"),"apartment_list_select_0"!=b.id&&0!=e.active&&b.setAttribute("disabled",!0);let E=[...b.options,].filter(e=>f.includes(e.value));return E.forEach(e=>{b.removeChild(e)}),b.addEventListener("change",({target:t})=>{let p=document.querySelector(`[data-drupal-selector="edit-apartment-${i}-id"]`),s=document.getElementsByClassName("application-form-apartment__apartment-add-button")[0],o=t.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;o.setAttribute("data-id",i),p.value=t.value,p.dispatchEvent(new Event("change")),o.classList.remove("application-form__apartments-item--with-select");let d=p.options[p.selectedIndex].text.split(" | "),m={apartment_number:d[0],apartment_structure:d[1],apartment_floor:d[2],apartment_living_area_size:d[3],apartment_debt_free_sales_price:d[4],apartment_sales_price:d[5]};o.innerHTML=x(m,t.value).innerHTML;let c=document.createElement("p");c.appendChild(document.createTextNode(n.ApartmentAdded[a])),l.append(c);let u=[...o.parentElement.children].indexOf(o);0===u&&(o.querySelector("button").disabled=!0),u===r()-1&&(o.querySelector('button[data-list-position-action-button="lower"]').disabled=!0),u>0&&(o.previousElementSibling.querySelector('button[data-list-position-action-button="lower"]').disabled=!1),o.nextElementSibling&&o.nextElementSibling.classList&&o.nextElementSibling.classList.contains("application-form__apartments-item--with-select")&&(o.querySelector('button[data-list-position-action-button="lower"]').disabled=!0),s&&(0==e.active&&s.removeAttribute("disabled"),s.focus())}),u.appendChild(b),d.append(m,u),t.appendChild(d),t},h=(e,t=[])=>{let a=document.createElement(e);return a.classList.add(...t),a},$=t=>{let i=t.parentElement.parentElement.parentElement,r=i.previousElementSibling;if(null!==r){r.before(i);let p=C(t),s=w(p);jQuery("#application_form_apartments_list").children("li").each((t,a)=>{let n=jQuery(a).first().find(".application-form-apartment__apartment-number").first()[0];if(void 0!=n){let l=e(n).find("span").last()[0].textContent,i=_(),r=i.filter(function(){return jQuery(this).find("option:selected").text().includes(l)});r.first().closest("tr").find("[data-drupal-selector$=-weight]")[0].value=t}}),s.change(),setTimeout(()=>{t.disabled&&t.nextElementSibling?t.nextElementSibling.focus():t.focus()},50);let o=document.createElement("p");o.appendChild(document.createTextNode(n.Updated[a])),l.append(o)}},g=a=>{let n=a.parentElement.parentElement.parentElement,i=n.nextElementSibling;if(null!==i&&!i.classList.contains("application-form__apartments-item--with-select")){i.after(n);let r=C(a),p=w(r);jQuery("#application_form_apartments_list").children("li").each((t,a)=>{let n=jQuery(a).first().find(".application-form-apartment__apartment-number").first()[0];if(void 0!=n){let l=e(n).find("span").last()[0].textContent,i=_(),r=i.filter(function(){return jQuery(this).find("option:selected").text().includes(l)});r.first().closest("tr").find("[data-drupal-selector$=-weight]")[0].value=t}}),p.change(),setTimeout(()=>{a.disabled&&a.previousElementSibling?a.previousElementSibling.focus():a.focus()},10);let s=document.createElement("p");s.appendChild(document.createTextNode(t.t("Apartment list order has been updated."))),l.append(s)}},v=e=>{jQuery(".application-form-apartment__apartment-delete-button").each((e,t)=>{jQuery(t).prop("disabled",!0)});let t=e.parentElement.parentElement.parentElement,i=C(e);if(!i)return;let r=w(i),p=r.closest("tr").find(":submit")[0],s=document.createElement("p");s.appendChild(document.createTextNode(n.ApartmentRemoved[a])),l.append(s),r.val(0),r.change(),t.innerHTML="<div class='application-form-apartment-loader-wrapper'><div class='application-form-apartment-loader'></div></div>",setTimeout(()=>{jQuery(p).trigger("mousedown"),jQuery("#application_form_apartments_list").empty(),T(),jQuery(".application-form-apartment__apartment-delete-button").each((e,t)=>{jQuery(t).prop("disabled",!1)})},750)},A=({target:e})=>{"raise"===e.getAttribute("data-list-position-action-button")&&$(e),"lower"===e.getAttribute("data-list-position-action-button")&&g(e),"application-form-apartment__apartment-delete-button"===e.getAttribute("class")&&v(e)},L=({target:t})=>{let a=e('[data-drupal-selector="edit-apartment-add-more"]');5>=r()&&r()>1&&"0"!==p().value&&a.mousedown();let n=t.parentElement,l=t.parentElement.parentElement.parentElement.parentElement;l.addEventListener("click",A),n.appendChild(E()),t.remove(),b(),5>r()&&S()},x=(e,l,i=!1)=>{let{apartment_number:p,apartment_structure:s,apartment_floor:o,apartment_living_area_size:d,apartment_sales_price:m,apartment_debt_free_sales_price:b}=e,E=document.querySelectorAll("[data-drupal-selector='asu-application-haso-form']"),$=E.length>0?"HASO":"hitas",g=h("li",["application-form__apartments-item",]);i&&g.classList.add("application-form__apartments-item--with-select");let v=h("article",["application-form-apartment",]),A=c(["application-form-apartment__list-position","is-desktop"],"List position",""),x=h("div",["application-form-apartment__header",]),y=c(["application-form-apartment__list-position","is-mobile"],"List position",""),S=c(["application-form-apartment__apartment-number"],"Apartment",p),_=c(["application-form-apartment__apartment-structure"],"Apartment structure",s),C=u(["application-form-apartment__apartment-add-button"],n.Add[a]);C.addEventListener("click",L),r()>0&&C.setAttribute("disabled",!0),i?x.append(y,C):x.append(y,S,_);let w=document.createElement("div");w.classList.add("application-form-apartment__list-position-actions");let N=u("",`Raise on the list, apartment ${p}`,i&&!0);N.setAttribute("data-list-position-action-button","raise");let T=u("",`Lower on the list, apartment ${p}`,i&&!0);T.setAttribute("data-list-position-action-button","lower"),w.append(N,T);let q=h("ul",["application-form-apartment__information",]),B=f("Floor",o),H=f("Living area size",d),O="",k="";"HASO"===$?(O=t.t("Right of occupancy payment"),k="",b=""):(O=t.t("Sales price"),k=t.t("Debt free sales price"));let D=f(O,m),M=f(k,b);q.append(B,H,D,M);let R=h("div",["application-form-apartment__actions",]),j=u(["application-form-apartment__apartment-delete-button"],n.Delete[a]);j.setAttribute("aria-label",`${n.Delete[a]}, ${n.Apartment[a]} ${p}`);let z=document.createElement("a"),I=document.createTextNode(n.Open[a]);return z.appendChild(I),z.setAttribute("href",`${window.location.origin}/node/${l}`),z.setAttribute("aria-label",`${n.Open[a]}, ${n.Apartment[a]} ${p}`),R.append(j,z),i?v.append(A,x,w):v.append(A,x,w,q,R),g.appendChild(v),g},y=()=>{jQuery("#application_form_apartments_list").children().not(":last").remove()},S=()=>{i.append(x({},null,!0))},_=()=>e('[data-drupal-selector="edit-apartment"] > table select'),C=e=>jQuery(e.parentElement.parentElement.parentElement).first().find(".application-form-apartment__apartment-number").first().find("span").last()[0].textContent,w=t=>{let a=e('[data-drupal-selector="edit-apartment"] > table select'),n=a.filter(function(){return jQuery(this).find("option:selected").text().includes(t)});return n.first()},N=()=>{if(s().length>0){let e=document.querySelectorAll('[data-drupal-selector="edit-apartment"] > table select'),t=[...e].filter(e=>e.getAttribute("data-drupal-selector").includes("-id")).filter(e=>"0"!==e.value);if(t.map(e=>{let t=e.options[e.selectedIndex].text.split(" | "),a={apartment_number:t[0],apartment_structure:t[1],apartment_floor:t[2],apartment_living_area_size:t[3],apartment_debt_free_sales_price:t[4],apartment_sales_price:t[5]};i.append(x(a,e.value,!1))}),1===r()){let a=document.getElementsByClassName("application-form__apartments-item")[0],n=a.querySelectorAll("[data-list-position-action-button]");[...n].map(e=>{e.disabled=!0})}if(5>r()){S();let l=document.getElementsByClassName("application-form-apartment__apartment-add-button")[0];l&&l.removeAttribute("disabled")}}0===r()&&S();let p=document.getElementsByClassName("application-form__apartments-item");p.length>0&&[...p].map((e,t)=>{e.setAttribute("data-id",t),e.addEventListener("click",A)})},T=()=>{y(),N()};window.onload=N})(jQuery,Drupal);
